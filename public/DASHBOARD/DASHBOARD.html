<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASHBOARD</title>
    <link rel="stylesheet" href="style-dash.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" href="../assets/favicon.png" type="image/x-icon">
</head>

<body>
    <div id="dashSidebar" class="sidebar">
        <img src="../assets/REDEMPTION.png" alt="">
        <a class="fecharbtn" onclick="fecharNav()">x</a>
        <a href="../BLACKJACK/BLACKJACK.html">BLACKJACK</a>
        <a href="../DASHBOARD/DASHBOARD.html">RANKING</a>
        <a href="../REGRAS/REGRAS.html">REGRAS</a>
        <a href="../HOME/HOME.html" onclick="sair()">SAIR</a>
    </div>

    <div id="conteudo">
        <button class="abrirbtn" onclick="abrirNav()">☰</button>
        <h2>DASHBOARD</h2>
        <p>Aqui estão presentes os gráficos com o ranking de melhores colocados no BLACKJACK.</p>
    </div>

    <div class="container1">
        <div class="ranking">
            <canvas id="myChart"></canvas>
        </div>
    </div>

    <div class="container2">
        <div class="estatistica">
            <canvas id="myChart2"></canvas>
        </div>
    </div>

</body>
</html>
<script>
    
    var idPegar = sessionStorage.idUsuario;
    //Inicio do script da sidebar
    function abrirNav() {
        dashSidebar.style.width = "250px";
        conteudo.style.marginLeft = "250px";
    }

    function fecharNav() {
        dashSidebar.style.width = "0";
        conteudo.style.marginLeft = "0";
    }

    function sair() {
        sessionStorage.clear();
        window.open('/public/LOGIN/LOGIN.html', '_self')
    }
    //Fim do script da sidebar

    var listaNomes = [];
    var listaVencida = [];
    var listaPerdida = [];
    var listaEmpatada = [];
    var listaTotal = [];

    //Gráfico Ranking
    function pegar() {
        const ctx = document.getElementById('myChart');
        //Chart JS
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: listaNomes,
                datasets: [{
                    label: '# of Votes',
                    data: listaVencida,
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        suggestedMin: 0,
                        suggestedMax: 10,
                        beginAtZero: true
                    }, x: {
                        ticks: {
                            color: 'white',
                            font: {
                                size: 15
                            }
                        }
                    }
                }
            }
        });
    }

    fetch('/blackjack/')
        .then(function (resposta) {
            resposta.json().then(function (res) {
                console.log(res)
                for (var cont = 0; cont < res.length; cont++) {
                    console.log(res)
                    console.log(res[cont])
                    listaNomes.push(res[cont].nome)
                    listaVencida.push(res[cont].qtdPartidasGanhas)
                    listaPerdida.push(res[cont].qtdPartidasPerdidas)
                    listaEmpatada.push(res[cont].qtdPartidasEmpatadas)
                    listaTotal.push(res[cont].qtdPartidasTotal)
                }
                pegar();
            })
        })

    var total = [];

    fetch(`/blackjack/resultado/${idPegar}`)
        .then(function (resposta) {
            resposta.json().then(function (res) {
                console.log(res)

                total.push(res[0].qtdPartidasGanhas)
                total.push(res[0].qtdPartidasPerdidas)
                total.push(res[0].qtdPartidasEmpatadas)

                console.log(`Dados resultado: ${total}`);
                pegar2(total);

            })
        })

   //Gráfico Estatísticas
    function pegar2(total) {

        var grafico = document.getElementById('myChart2');

        var pieChart = new Chart(grafico, {
            type: 'pie',
            data: {
                labels: ['Vitórias', 'Derrotas', 'Empates'],
                datasets: [{
                    label: 'Quantidade',
                    data: total,
                    borderColor: "#FFFF",
                    backgroundColor: [
                        "#B0E0E6", "#FF4500", "#2E8B57", "#FF0000", "#FFFF00"
                    ]
                }]
            },
            options: {
                // Opções específicas para o gráfico de pizza
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        enabled: true,
                    }
                }
            }
        });
    }

</script>