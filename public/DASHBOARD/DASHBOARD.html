<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASHBOARD</title>
    <link rel="stylesheet" href="style-dash.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" href="../assets/favicon.png" type="image/x-icon">
</head>

<body>
    <div id="dashSidebar" class="sidebar">
        <img src="../assets/REDEMPTION.png" alt="">
        <a class="fecharbtn" onclick="fecharNav()">x</a>
        <a href="../BLACKJACK/BLACKJACK.html">BLACKJACK</a>
        <a href="../DASHBOARD/DASHBOARD.html">DASHBOARD</a>
        <a href="../REGRAS/REGRAS.html">REGRAS</a>
        <a href="../HOME/HOME.html" onclick="sair()">SAIR</a>
    </div>

    <div id="conteudo" class="conteudo">
        <button class="abrirbtn" onclick="abrirNav()">☰</button>
        <h2>DASHBOARD</h2>
        <p>Aqui estão presentes os gráficos com o ranking de melhores colocados no BLACKJACK, e as estatísticas do seu jogo.</p>
    </div>

    <div class="kpis">
        <div class="kpi">
            <h3>Suas Vitórias</h3>
            <p id="vitorias">0</p>
        </div>
        <div class="kpi">
            <h3>Suas Derrotas</h3>
            <p id="derrotas">0</p>
        </div>
        <div class="kpi">
            <h3>Seus Empates</h3>
            <p id="empates">0</p>
        </div>
    </div>

    <div class="graficos">
        <div class="container1">
            <h1>RANKING GERAL</h1>
            <div class="ranking">
                <canvas id="myChart" class="graficoBarra"></canvas>
            </div>
        </div>
    
        <div class="container2">
            <h1>ESTATÍSTICA DO SEU JOGO</h1>
            <div class="estatistica">
                <canvas id="myChart2" class="graficoBarra"></canvas>
            </div>
        </div>

    </div>

</body>

</html>
<script>

    //Inicio do script da sidebar

    function abrirNav() {
        dashSidebar.style.width = "250px";
        conteudo.style.marginLeft = "250px";
    }

    function fecharNav() {
        dashSidebar.style.width = "0";
        conteudo.style.marginLeft = "0";
    }

    function sair() {
        sessionStorage.clear();
        window.open('/public/LOGIN/LOGIN.html', '_self')
    }

    //Fim do script da sidebar

    var listaNomes = [];
    var listaVencida = [];
    var listaPerdida = [];
    var listaEmpatada = [];
    var listaTotal = [];

    // ESSE ESTÁ SENDO USADO NA FUNÇÃO estatistica

    var idPegar = sessionStorage.idUsuario;

    var total = [];

    // GRAFICO RANKING

function pegar() {
    const ctx = document.getElementById('myChart');
    // Chart JS
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: listaNomes,
            datasets: [{
                label: 'Quantidade de vitórias',
                data: listaVencida,
                backgroundColor: '#1AD101', 
                borderColor: '#242021', 
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    suggestedMin: 0,
                    suggestedMax: 10,
                    beginAtZero: true,
                    grid: {
                            color:'#FFFFFF'
                        }
                    
                },
                x: {
                    ticks: {
                        color: 'white',
                        font: {
                            size: 15
                        },
                        grid: {
                            color:'#000000'
                        }
                    } 
                }
            }
        }
    });
}

// GRAFICO - RESULTADO DA PARTIDA

function estatistica(total) {
    var grafico = document.getElementById('myChart2');

    new Chart(grafico, {
        type: 'pie',
        data: {
            labels: ['Vitórias', 'Derrotas', 'Empates'],
            datasets: [{
                label: 'Quantidade',
                data: total,
                borderColor: '#FFFFFF',
                backgroundColor: [
                    '#1AD101', 
                    '#D61A07', 
                    '#D5C2B1'  
                ],
                borderColor: [
                    '#242021', 
                    '#242021', 
                    '#242021'  
                ],
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    enabled: true,
                }
            }
        }
    });
}
    // FETCH - RANKING

    fetch('/blackjack/')
        .then(function (resposta) {
            resposta.json().then(function (res) {
                console.log(res)
                for (var cont = 0; cont < res.length; cont++) {
                    console.log(res)
                    console.log(res[cont])
                    listaNomes.push(res[cont].nome)
                    listaVencida.push(res[cont].qtdPartidasGanhas)
                    listaPerdida.push(res[cont].qtdPartidasPerdidas)
                    listaEmpatada.push(res[cont].qtdPartidasEmpatadas)
                    listaTotal.push(res[cont].qtdPartidasTotal)
                }
                pegar();
            })
        })

    // FETCH - ESTATISTICAS

    fetch(`/blackjack/resultado/${idPegar}`)
        .then(function (resposta) {
            resposta.json().then(function (res) {
                console.log(res)

                total.push(res[0].qtdPartidasGanhas)
                total.push(res[0].qtdPartidasPerdidas)
                total.push(res[0].qtdPartidasEmpatadas)

                // Update KPIs
            vitorias.innerHTML = res[0].qtdPartidasGanhas;
            derrotas.innerHTML = res[0].qtdPartidasPerdidas;
            empates.innerHTML = res[0].qtdPartidasEmpatadas;
            
                console.log(`resultado do jogo: ${total}`);
                estatistica(total);

            })
        })

</script>